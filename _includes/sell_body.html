<section class="section">
    <div class="container">
        <div class="box">
            <div class="container">
                <div class="has-text-centered" style="margin-bottom:2em;">
                    <img src="/assets/images/{{page.stub}}.png" alt="{{page.title}}"
                        style="max-width:300px; width:100%; margin:0 auto; display:block;">
                </div>
                <h1 class="title has-text-centered">{{page.title}}</h1>
                <h3 class="subtitle has-text-centered" style="margin-bottom:2em;">Support <i class="scoutname"></i> in raising funds for {{site.scout_type}} {{ site.unit_type }} {{ site.unit_number }}!</h3>
            </div>
            <div id="popcornfundraiser" style="display:none;">
                <p>Want popcorn? Click the button below to visit the Scoutâ€™s personalized popcorn ordering page.</p>
                <a id="popcornlink" class="button is-warning is-medium" href="{{ site.popcorn_base_link }}"
                    target="_blank" style="margin:1em 0;">
                    <span class="icon"><i class="fas fa-boxes-stacked"></i></span>
                    <span>Order Popcorn</span>
                </a>
            </div>

            <div>
                <p>Interested in coffee? Please read the instructions below before ordering.</p>
                <!-- Manual slideshow for instructions -->
                <div id="instructions-slideshow" style="max-width:350px; margin:1.5em auto; text-align:center;">
                    <button id="slide-prev" style="margin-right:1em;">&#8592;</button>
                    <img id="slide-img" src="/assets/images/coffee-instruct1.png" alt="Instruction 1" style="max-width:300px; width:100%; display:inline-block; vertical-align:middle;">
                    <button id="slide-next" style="margin-left:1em;">&#8594;</button>
                    <div id="slide-caption" style="margin-top:0.5em; font-weight:bold;">Step 1</div>
                </div>
                
                <p>When ordering, please enter the following information for each item:</p>
                <div class="table-container" style="max-width: 300px; margin: 0 auto;">
                    <table class="table is-striped">
                        <tbody>
                            <tr>
                                <th>District</th>
                                <td>{{ site.district }}</td>
                            </tr>
                            <tr>
                                <th>Unit Type</th>
                                <td>{{ site.unit_type }}</td>
                            </tr>
                            <tr>
                                <th>Unit Number</th>
                                <td>{{ site.unit_number }}</td>
                            </tr>
                            <tr>
                                <th>Scout Name</th>
                                <td><span class="scoutname" id="scoutname"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin:1em 0;">
                    <a class="button is-link is-medium" href="{{ site.coffee_link }}" target="_blank" style="margin:1em 0;">
                        <span class="icon"><i class="fas fa-mug-hot"></i></span>
                        <span>Order Coffee</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Move script to end of body for valid HTML -->
<script>
    // Simple slideshow logic
    const slideImages = [
        '/assets/images/coffee-instruct1.png',
        '/assets/images/coffee-instruct2.png',
        '/assets/images/coffee-instruct3.png'
    ];
    const slideCaptions = [
        'Step 1',
        'Step 2',
        'Step 3'
    ];
    let slideIndex = 0;
    function showSlide(idx) {
        const img = document.getElementById('slide-img');
        const cap = document.getElementById('slide-caption');
        img.src = slideImages[idx];
        img.alt = 'Instruction ' + (idx + 1);
        cap.textContent = slideCaptions[idx];
    }
    document.getElementById('slide-prev').onclick = function() {
        slideIndex = (slideIndex - 1 + slideImages.length) % slideImages.length;
        showSlide(slideIndex);
    };
    document.getElementById('slide-next').onclick = function() {
        slideIndex = (slideIndex + 1) % slideImages.length;
        showSlide(slideIndex);
    };
    // Initialize first slide
    showSlide(slideIndex);
    function getQuery() {
        const params = new URLSearchParams(window.location.search);
        return {
            scout: params.get('scout') || '',
            popcorn: params.get('popcorn') || ''
        };
    }
    function render() {
        const query = getQuery();
        // Scout name
        document.querySelectorAll('.scoutname').forEach(function (el) { el.textContent = query.scout || ''; });
        // Popcorn
        if (query.popcorn && query.scout) {
            document.getElementById('popcornfundraiser').style.display = '';
            document.getElementById('popcornlink').href = "{{ site.popcorn_base_link }}" + query.popcorn;
        } else {
            document.getElementById('popcornfundraiser').style.display = 'none';
            document.getElementById('popcornlink').href = '{{ site.popcorn_base_link }}';
        }
        // Error if missing scout
        if (!query.scout) {
            document.getElementById('popcornfundraiser').style.display = 'none';
            // Optionally show error message
            document.getElementById('scoutname').parentElement.innerHTML = '<b>Error:</b> Missing scout name.';
        }
    }
    render();
</script>